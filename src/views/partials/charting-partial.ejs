<span id='variableJSON' hidden>
    <%= JSON.stringify(stockResponse); %>
</span>

<div id='chart'></div>


<script>
    // Had to stick the data in the HTML, then access it in the script below like so...
    const variableJSON = JSON.parse(document.getElementById('variableJSON').innerHTML);
    document.getElementById('variableJSON').remove();

    let data = [];
    let categories = [];

    let stockPriceTimeSeriesJSON = variableJSON['Time Series (Daily)'];

    let stockTicker = variableJSON['Meta Data']['2. Symbol'];

    let keys = Object.keys(stockPriceTimeSeriesJSON)

    categories.push(keys);

    let entries = Object.entries(stockPriceTimeSeriesJSON)

    entries.forEach( (key) => {
        data.push(key[1]['4. close']);        
    });


    var options = {
        series: [{
            name: "Stock Close Price",
            // Add the stock prices below here
            // data: [10, 41, 35, 51, 49, 62, 69, 91, 148]
            data: data
        }],
        chart: {
            height: 350,
            type: 'line',
            zoom: {
                enabled: false
            }
        },
        dataLabels: {
            enabled: false
        },
        stroke: {
            curve: 'straight'
        },
        title: {
            text: stockTicker,
            align: 'left'
        },
        grid: {
            row: {
                colors: ['#f3f3f3', 'transparent'], // takes an array which will be repeated on columns
                opacity: 0.5
            },
        },
        xaxis: {
            // Add the dates here
            // categories: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep'],
            categories: categories[0],
        }
    };

    var chart = new ApexCharts(document.querySelector('#chart'), options);
    chart.render();

</script>}